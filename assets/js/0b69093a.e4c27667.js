"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[383],{3478:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"infra/kube","title":"Kubernetes","description":"Description of Kubernetes deployment infrastructure","source":"@site/docs/infra/kube.md","sourceDirName":"infra","slug":"/infra/kube","permalink":"/ftl/docs/infra/kube","draft":false,"unlisted":false,"editUrl":"https://github.com/block/ftl/tree/main/docs/docs/infra/kube.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Kubernetes","description":"Description of Kubernetes deployment infrastructure"},"sidebar":"tutorialSidebar","previous":{"title":"Infrastructure","permalink":"/ftl/docs/category/infrastructure"},"next":{"title":"User Deployments","permalink":"/ftl/docs/infra/user-deployments"}}');var s=i(7968),o=i(4205);const r={sidebar_position:1,title:"Kubernetes",description:"Description of Kubernetes deployment infrastructure"},l="Kubernetes",d={},c=[{value:"Components and Namespaces",id:"components-and-namespaces",level:2},{value:"Provisioning User Deployments",id:"provisioning-user-deployments",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"kubernetes",children:"Kubernetes"})}),"\n",(0,s.jsx)(n.p,{children:"FTL is designed to be deployed on Kubernetes, ideally with Istio installed for traffic management. This document describes the Kubernetes deployment infrastructure, including the use of Istio and other components."}),"\n",(0,s.jsx)(n.h2,{id:"components-and-namespaces",children:"Components and Namespaces"}),"\n",(0,s.jsxs)(n.p,{children:["By default, FTL will be deployed in the ",(0,s.jsx)(n.code,{children:"ftl"})," namespace. The following deployments are included:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Schema Service* (",(0,s.jsx)(n.code,{children:"ftl-schema"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Console (",(0,s.jsx)(n.code,{children:"ftl-console"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Admin Service (",(0,s.jsx)(n.code,{children:"ftl-admin"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Provisioner (",(0,s.jsx)(n.code,{children:"ftl-provisioner"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Cron Service* (",(0,s.jsx)(n.code,{children:"ftl-cron"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Lease Service (",(0,s.jsx)(n.code,{children:"ftl-lease"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Timeline Service (",(0,s.jsx)(n.code,{children:"ftl-timeline"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Ingress Service (",(0,s.jsx)(n.code,{children:"ftl-ingress"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"*StatefulSet with 3 replicas and Persistent Volumes"}),"\n",(0,s.jsxs)(n.p,{children:["End user deployments will generally be deployed into either a separate shared namespace, or to a namespace per module\nof the form ",(0,s.jsx)(n.code,{children:"<module>-<realm>"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"provisioning-user-deployments",children:"Provisioning User Deployments"}),"\n",(0,s.jsxs)(n.p,{children:["When a user deploys a module, the FTL Provisioner will create a new namespace if required for the module and deploy the module into that namespace.\nThe namespace will be named ",(0,s.jsx)(n.code,{children:"<module>-<realm>"}),", where ",(0,s.jsx)(n.code,{children:"<module>"})," is the name of the module and ",(0,s.jsx)(n.code,{children:"<realm>"})," is the name of the realm."]}),"\n",(0,s.jsx)(n.p,{children:"Each new version of the module gets a new kubernetes deployment, so that the old version can be kept running until the new version is verified to be working.\nThis will eventually allow FTL to perform canary deployments and other advanced deployment strategies. Each deployment has a service created for it, and\nFTL controls the routing of traffic to the correct service."}),"\n",(0,s.jsx)(n.p,{children:"When a module is first deployed a Kube ServiceAccount will also be created with the same name as the module. This ServiceAccount will be used to run the module's pods, and is used as the workload identity."}),"\n",(0,s.jsxs)(n.p,{children:["If istio is installed in the cluster, the namespace will be provisioned with Istio sidecar injection enabled. When the modules are provisioned they will also have\nIstio ",(0,s.jsx)(n.code,{children:"AuthorizationPolicy"})," resources created to control the traffic to and from the module. FTL will provision these policies with the following rules:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If the module has HTTP ingres verbs then it will allow traffic from the ingress service to the module"}),"\n",(0,s.jsx)(n.li,{children:"If the module has Cron jobs then it will allow traffic from the cron service to the module"}),"\n",(0,s.jsxs)(n.li,{children:["Invocations from the ",(0,s.jsx)(n.code,{children:"ftl-admin"})," service will be allowed for CLI invocations"]}),"\n",(0,s.jsxs)(n.li,{children:["Invocations from ",(0,s.jsx)(n.code,{children:"ftl-console"})," will be allowed for console invocations"]}),"\n",(0,s.jsxs)(n.li,{children:["A new ",(0,s.jsx)(n.code,{children:"AuthorizationPolicy"})," will be created for each module that is called by this module, as identified by the ",(0,s.jsx)(n.code,{children:"+calls"})," metadata in the schema."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Other invocations are disallowed by default. This is to ensure that modules are not able to call each other without this being explicitly identified in the schema."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},4205:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var t=i(4700);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);