<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/databases" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Databases | FTL</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://block.github.io/ftl/docs/reference/databases"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:title" content="FTL Documentation"><meta data-rh="true" name="og:description" content="FTL is a platform for building distributed systems that are safe to operate, easy to reason about, and fast to iterate and develop on."><meta data-rh="true" property="og:image" content="/ftl/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:image" content="/ftl/img/docusaurus-social-card.jpg"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Databases | FTL"><meta data-rh="true" name="description" content="Working with databases in FTL"><meta data-rh="true" property="og:description" content="Working with databases in FTL"><link data-rh="true" rel="icon" href="/ftl/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://block.github.io/ftl/docs/reference/databases"><link data-rh="true" rel="alternate" href="https://block.github.io/ftl/docs/reference/databases" hreflang="en"><link data-rh="true" rel="alternate" href="https://block.github.io/ftl/docs/reference/databases" hreflang="x-default"><link rel="stylesheet" href="/ftl/assets/css/styles.865a8d9e.css">
<script src="/ftl/assets/js/runtime~main.0085bc17.js" defer="defer"></script>
<script src="/ftl/assets/js/main.5ca8024b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_ovjw" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ftl/"><b class="navbar__title text--truncate">FTL</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ftl/docs/category/getting-started">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/block/ftl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ILK4"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_F03X colorModeToggle_QuPq"><button class="clean-btn toggleButton_WiMr toggleButtonDisabled_BIlY" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FuoF"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_kerf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_xhDY"><div class="navbar__search searchBarContainer_tPD2" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_f93m" value=""><div class="loadingRing_RBKN searchBarLoadingRing_KMHm"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_gBxF"><div class="docsWrapper_maW7"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KPc_" type="button"></button><div class="docRoot_On6v"><aside class="theme-doc-sidebar-container docSidebarContainer_v5Fq"><div class="sidebarViewport_uvvs"><div class="sidebar_LYVy"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiV4"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/ftl/docs/category/getting-started">Getting Started</a><button aria-label="Collapse sidebar category &#x27;Getting Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/getting-started/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/ftl/docs/category/reference">Reference</a><button aria-label="Collapse sidebar category &#x27;Reference&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/verbs">Verbs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/types">Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/visibility">Visibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/cron">Cron</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/fixtures">Cron</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/unittests">Unit Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/pubsub">PubSub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/retries">Retries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/secretsconfig">Secrets/Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/matrix">Feature Matrix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/ingress">HTTP Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ftl/docs/reference/externaltypes">External Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ftl/docs/reference/databases">Databases</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_Xnxp"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Z_IA"><div class="docItemContainer__XKV"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_EKIo" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ftl/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_M1gs"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/ftl/docs/category/reference"><span itemprop="name">Reference</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Databases</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_Qgvn theme-doc-toc-mobile tocMobile_N_VK"><button type="button" class="clean-btn tocCollapsibleButton_bD_i">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Databases</h1></header>
<p>FTL has support for Postgresql and MySQL databases, including support for automatic provisioning and migrations.</p>
<!-- -->
<div class="tabs-container tabList_m0Yb"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Mhwx tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Schema</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_LXtO"><p>Your database is automatically declared by following a specific directory structure for your SQL files. No additional configuration is needed - just create the directory structure and FTL will handle the rest. See the <a href="#creating-a-new-database">Creating a New Database</a> section for CLI shortcuts.</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>Your database is automatically declared by following a specific directory structure for your SQL files. No additional configuration is needed - just create the directory structure and FTL will handle the rest. See the <a href="#creating-a-new-database">Creating a New Database</a> section for CLI shortcuts.</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>Your database is automatically declared by following a specific directory structure for your SQL files. No additional configuration is needed - just create the directory structure and FTL will handle the rest. See the <a href="#creating-a-new-database">Creating a New Database</a> section for CLI shortcuts.</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>In the FTL schema, databases are represented using the <code>database</code> keyword with the engine type and name:</p><div class="language-schema codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-schema codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> example </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Database declaration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">postgres</span><span class="token plain"> testdb  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">migration</span><span class="token plain"> sha256</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">59b989063b6de57a1b6867e8ad7915109c9b8632616118c6ef23e4439cf17f8e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Data structures for database operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> CreateUserParams </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> UserResult </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query that returns a single row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserResult</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> one </span><span class="token string" style="color:#e3116c">&quot;SELECT id, name, email FROM users WHERE id = ?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query that returns multiple rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> listUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserResult</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">many</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT id, name, email FROM users ORDER BY name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query that performs an action but doesn&#x27;t return data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateUserParams</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INSERT INTO users (name, email) VALUES (?, ?)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Custom verb that uses a database query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> getUserEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The schema representation includes:</p><ol>
<li>A <code>database</code> declaration with the engine type (<code>postgres</code> or <code>mysql</code>) and database name</li>
<li>The <code>+migration</code> annotation with a SHA256 hash of the migration files</li>
<li>Data structures with <code>+sql column</code> annotations mapping to database columns</li>
<li>Verb declarations with <code>+database calls</code> and <code>+sql query</code> annotations specifying the query type and SQL statement</li>
</ol></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_T536" id="creating-a-new-database">Creating a New Database<a href="#creating-a-new-database" class="hash-link" aria-label="Direct link to Creating a New Database" title="Direct link to Creating a New Database">​</a></h2>
<p>To create a new database with the required directory structure, you can use the <code>ftl postgres new</code> or <code>ftl mysql new</code> command. The format of the command is:</p>
<div class="language-bash codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-bash codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token plain">ftl </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">engine</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> new </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">datasource</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Where:</p>
<ul>
<li><code>&lt;engine&gt;</code> is either <code>mysql</code> or <code>postgres</code></li>
<li><code>&lt;module&gt;.&lt;datasource&gt;</code> is the qualified name of the datasource (module name can be omitted if in a single module directory)</li>
</ul>
<p>For example:</p>
<div class="language-bash codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-bash codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token plain">ftl mysql new mymodule.mydb    </span><span class="token comment" style="color:#999988;font-style:italic"># Create a MySQL database named &quot;mydb&quot; in module &quot;mymodule&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ftl postgres new mydb          </span><span class="token comment" style="color:#999988;font-style:italic"># Create a PostgreSQL database named &quot;mydb&quot; in the current module</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This command will:</p>
<ol>
<li>Create the appropriate directory structure</li>
<li>Create an initial migration file in the <code>schema</code> directory</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_T536" id="sql-file-structure">SQL File Structure<a href="#sql-file-structure" class="hash-link" aria-label="Direct link to SQL File Structure" title="Direct link to SQL File Structure">​</a></h2>
<p>In order to be discoverable by FTL, the SQL files in your project must follow a specific directory structure. FTL supports two database engines, declared via the directory hierarchy as either <code>mysql</code> or <code>postgres</code>:</p>
<div class="tabs-container tabList_m0Yb"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Mhwx tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Java</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_LXtO"><p>For Go projects, SQL files must be located in:</p><div class="codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-text codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token plain">db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── mysql/           # must be exactly &quot;mysql&quot; or &quot;postgres&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── mydb/        # database name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── schema/  # contains migration files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── queries/ # contains query files</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The presence of a <code>schema</code> directory under your database name automatically declares the database in FTL.</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>For Kotlin projects, SQL files must be located in:</p><div class="codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-text codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token plain">src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mysql/           # must be exactly &quot;mysql&quot; or &quot;postgres&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── mydb/        # database name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── schema/  # contains migration files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── queries/ # contains query files</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The presence of a <code>schema</code> directory under your database name automatically declares the database in FTL.</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>For Java projects, SQL files must be located in:</p><div class="codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-text codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token plain">src/main/resources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mysql/           # must be exactly &quot;mysql&quot; or &quot;postgres&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── mydb/        # database name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── schema/  # contains migration files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── queries/ # contains query files</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The presence of a <code>schema</code> directory under your database name automatically declares the database in FTL.</p></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_T536" id="schema-directory">Schema Directory<a href="#schema-directory" class="hash-link" aria-label="Direct link to Schema Directory" title="Direct link to Schema Directory">​</a></h3>
<p>The <code>schema</code> directory contains all your database migration <code>.sql</code> files. These files are used to create and modify your database schema.</p>
<h3 class="anchor anchorWithStickyNavbar_T536" id="queries-directory">Queries Directory<a href="#queries-directory" class="hash-link" aria-label="Direct link to Queries Directory" title="Direct link to Queries Directory">​</a></h3>
<p>The <code>queries</code> directory contains <code>.sql</code> files with any SQL queries you would like generated as FTL verbs for use in your module. These queries must be annotated with <a href="https://docs.sqlc.dev/" target="_blank" rel="noopener noreferrer">SQLC annotation syntax</a>. FTL will automatically lift these queries into the module schema and provide a type-safe client to execute each query.</p>
<p>Find more information in the <a href="#using-generated-query-clients">Using Generated Query Clients</a> section below.</p>
<h2 class="anchor anchorWithStickyNavbar_T536" id="provisioning">Provisioning<a href="#provisioning" class="hash-link" aria-label="Direct link to Provisioning" title="Direct link to Provisioning">​</a></h2>
<p>FTL includes support for automatically provisioning databases. The actual backing implementation is
extensible, and presently we include support for both local development provisioning using docker,
and cloud formations based provisioning for AWS deployments. When using <code>ftl dev</code> a docker container
will automatically be spun up for each datasource that has been defined, and FTL will automatically
handle configuration. The same applies when deploying to an AWS cluster with cloud formations
provisioning setup.</p>
<h2 class="anchor anchorWithStickyNavbar_T536" id="migrations">Migrations<a href="#migrations" class="hash-link" aria-label="Direct link to Migrations" title="Direct link to Migrations">​</a></h2>
<p>FTL includes support for automatically running migrations on databases. This is provided by <a href="https://github.com/amacneil/dbmate" target="_blank" rel="noopener noreferrer">dbmate</a>.</p>
<p>To create additional migrations you can use the <code>ftl postgres new migration</code> or <code>ftl mysql new migration</code> command. The format of the command is <code>ftl &lt;engine&gt; new migration &lt;module&gt;.&lt;datasource&gt; &lt;migration-name&gt;</code>.</p>
<p>The module name can be omitted if the current working directory only contains a single module.</p>
<p>E.g. to create a new migration called <code>init</code> for the <code>testdb</code> datasource in the <code>mysql</code> module you would run <code>ftl mysql new migration mysql.testdb init</code>.</p>
<p>When the modules are provisioned FTL will automatically run these migrations for you.</p>
<h2 class="anchor anchorWithStickyNavbar_T536" id="connecting-with-your-db">Connecting with your DB<a href="#connecting-with-your-db" class="hash-link" aria-label="Direct link to Connecting with your DB" title="Direct link to Connecting with your DB">​</a></h2>
<p>There are two supported ways to interact with your database in FTL: using the generated database handle to perform raw queries, or using generated query clients.</p>
<h3 class="anchor anchorWithStickyNavbar_T536" id="using-the-generated-database-handle">Using the Generated Database Handle<a href="#using-the-generated-database-handle" class="hash-link" aria-label="Direct link to Using the Generated Database Handle" title="Direct link to Using the Generated Database Handle">​</a></h3>
<div class="tabs-container tabList_m0Yb"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Mhwx tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Schema</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_LXtO"><p>Once you&#x27;ve declared a database, FTL automatically generates a database handle that provides direct access to the underlying connection. You can use this to execute raw SQL queries (where <code>MydbHandle</code> is the generated handle type for the <code>mydb</code> datasource):</p><div class="language-go codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-go codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ftl:verb export</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db MydbHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">QueryContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT data FROM requests&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> items </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Err</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>TBD</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>TBD</p></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>In the FTL schema, the database handle is represented by the <code>+database calls</code> annotation on verbs:</p><div class="language-schema codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-schema codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> example </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Database declaration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">postgres</span><span class="token plain"> mydb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">migration</span><span class="token plain"> sha256</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">59b989063b6de57a1b6867e8ad7915109c9b8632616118c6ef23e4439cf17f8e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Verb that uses the database handle directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">String</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mydb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you use a database handle in your code, you&#x27;re directly accessing the underlying database connection. The FTL compiler automatically generates the appropriate handle type based on the database declaration.</p></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_T536" id="using-generated-query-clients">Using Generated Query Clients<a href="#using-generated-query-clients" class="hash-link" aria-label="Direct link to Using Generated Query Clients" title="Direct link to Using Generated Query Clients">​</a></h3>
<p>For better type safety and maintainability, FTL can automatically generate type-safe query clients from SQL files in your <code>queries</code> directory. Your SQL files must be annotated with <a href="https://docs.sqlc.dev/" target="_blank" rel="noopener noreferrer">SQLC annotation syntax</a> to specify the type of query and its parameters. For example:</p>
<div class="language-sql codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-sql codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- name: GetUser :one</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- name: ListUsers :many</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- name: CreateUser :exec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> users </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These queries will be automatically converted into FTL verbs with corresponding generated clients that you can inject into your verbs just like any other verb client. For example:</p>
<div class="tabs-container tabList_m0Yb"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Mhwx tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Schema</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_LXtO"><div class="language-go codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-go codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ftl:verb export</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query GetUserClient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><div class="language-kotlin codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-kotlin codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token annotation builtin">@Verb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GetUserClient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><div class="language-java codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-java codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Verb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">GetUserClient</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">UserResult</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>In the FTL schema, the generated query clients are represented as verbs with the <code>+database calls</code> and <code>+sql query</code> annotations:</p><div class="language-schema codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-schema codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> example </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Database declaration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">postgres</span><span class="token plain"> testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">migration</span><span class="token plain"> sha256</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">59b989063b6de57a1b6867e8ad7915109c9b8632616118c6ef23e4439cf17f8e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Data structures for query results and parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> UserResult </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> CreateUserParams </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query that returns a single row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserResult</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> one </span><span class="token string" style="color:#e3116c">&quot;SELECT id, name, email FROM users WHERE id = ?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query that returns multiple rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> listUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserResult</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">many</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT id, name, email FROM users ORDER BY name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query that performs an action but doesn&#x27;t return data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateUserParams</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INSERT INTO users (name, email) VALUES (?, ?)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Custom verb that uses the generated query client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> getUserEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getUser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you use a generated query client in your code, you&#x27;re calling a verb that has been automatically generated from your SQL query. FTL handles the mapping between your SQL queries and the generated verbs.</p></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_T536" id="transactions">Transactions<a href="#transactions" class="hash-link" aria-label="Direct link to Transactions" title="Direct link to Transactions">​</a></h2>
<p>FTL provides transaction support through verb annotations. When a verb is marked as transactional, FTL will automatically manage the transaction boundaries - beginning the transaction when the verb is called, committing if the verb completes successfully, and rolling back if any errors occur during execution.</p>
<div class="tabs-container tabList_m0Yb"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_Mhwx tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Kotlin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_Mhwx">Schema</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_LXtO"><p>To mark a verb as transactional, use the <code>//ftl:transaction</code> comment directive:</p><div class="language-go codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-go codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> CreateUserRequest </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name  </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Email </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ftl:transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req CreateUserRequest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db MydbHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> createAddress CreateAddressClient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// All database operations within this verb will be executed in a single transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;INSERT INTO users (name, email) VALUES ($1, $2)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction will be rolled back</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LastInsertId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction will be rolled back</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// createAddress is a generated query client from a SQL file in queries/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AddressRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">UserId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction will be rolled back</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction will be committed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>To mark a verb as transactional, use the <code>@Transactional</code> annotation:</p><div class="language-kotlin codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-kotlin codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateUserRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> email</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation builtin">@Transactional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> CreateUserRequest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createAddress</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> CreateAddressClient </span><span class="token comment" style="color:#999988;font-style:italic">// Generated query client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Unit </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// createAddress is a generated query client from a SQL file in queries/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createAddress</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">AddressRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction commits if we reach here without errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Any errors will cause automatic rollback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>To mark a verb as transactional, use the <code>@Transactional</code> annotation:</p><div class="language-java codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-java codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CreateUserRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UserService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Transactional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CreateUserRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CreateAddressClient</span><span class="token plain"> createAddress  </span><span class="token comment" style="color:#999988;font-style:italic">// Generated query client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// createAddress is a generated query client from a SQL file in queries/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        createAddress</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AddressRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction commits if we reach here without errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Any errors will cause automatic rollback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_LXtO" hidden=""><p>In the FTL schema, transaction verbs are represented with the <code>+transaction</code> annotation:</p><div class="language-schema codeBlockContainer_TUUa theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_UGXE"><pre tabindex="0" class="prism-code language-schema codeBlock_cCjM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kswp"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> example </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Database declaration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">postgres</span><span class="token plain"> mydb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">migration</span><span class="token plain"> sha256</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">59b989063b6de57a1b6867e8ad7915109c9b8632616118c6ef23e4439cf17f8e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> CreateUserRequest </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> AddressRequest </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userId </span><span class="token keyword" style="color:#00009f">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;addresses&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    street </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;addresses&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;street&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    city </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;addresses&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;city&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Generated query client from SQL file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> createAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AddressRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mydb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INSERT INTO addresses (user_id, street, city) VALUES (?, ?, ?)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Transaction verb that uses both direct database access and a generated query client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">verb</span><span class="token plain"> createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateUserRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">transaction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mydb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">calls</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">createAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_CkIX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_zA7l" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EmPV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Gzb6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_T536" id="transaction-rules-and-limitations">Transaction Rules and Limitations<a href="#transaction-rules-and-limitations" class="hash-link" aria-label="Direct link to Transaction Rules and Limitations" title="Direct link to Transaction Rules and Limitations">​</a></h3>
<p>When using transactions, FTL enforces the following restrictions:</p>
<ol>
<li>
<p><strong>Database Usage</strong>: Transaction verbs must use at least one database resource (either through a database handle or SQL query clients). FTL infers which database to open the transaction against based on these usages.</p>
</li>
<li>
<p><strong>Single Database</strong>: FTL only supports transactions against a single database. Two-phase commits across multiple databases are not supported.</p>
</li>
<li>
<p><strong>No Nesting</strong>: Transaction verbs cannot be nested. This means you cannot inject another transaction verb&#x27;s client as a resource within a transaction verb.</p>
</li>
<li>
<p><strong>Module Scope</strong>: Transaction verbs can only call other verbs within the same module. Calls to external verbs from other modules are not allowed within a transaction.</p>
</li>
<li>
<p><strong>Automatic Management</strong>: Transaction boundaries are automatically managed by FTL:</p>
<ul>
<li>The transaction begins when the verb is called</li>
<li>The transaction commits if the verb completes successfully</li>
<li>The transaction rolls back if any errors occur during execution</li>
</ul>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/block/ftl/tree/main/docs/docs/reference/databases.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_K72f" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JHvS"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ftl/docs/reference/externaltypes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">External Types</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_uGBQ thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-a-new-database" class="table-of-contents__link toc-highlight">Creating a New Database</a></li><li><a href="#sql-file-structure" class="table-of-contents__link toc-highlight">SQL File Structure</a><ul><li><a href="#schema-directory" class="table-of-contents__link toc-highlight">Schema Directory</a></li><li><a href="#queries-directory" class="table-of-contents__link toc-highlight">Queries Directory</a></li></ul></li><li><a href="#provisioning" class="table-of-contents__link toc-highlight">Provisioning</a></li><li><a href="#migrations" class="table-of-contents__link toc-highlight">Migrations</a></li><li><a href="#connecting-with-your-db" class="table-of-contents__link toc-highlight">Connecting with your DB</a><ul><li><a href="#using-the-generated-database-handle" class="table-of-contents__link toc-highlight">Using the Generated Database Handle</a></li><li><a href="#using-generated-query-clients" class="table-of-contents__link toc-highlight">Using Generated Query Clients</a></li></ul></li><li><a href="#transactions" class="table-of-contents__link toc-highlight">Transactions</a><ul><li><a href="#transaction-rules-and-limitations" class="table-of-contents__link toc-highlight">Transaction Rules and Limitations</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ftl/docs/getting-started/quick-start">Quickstart</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/blocks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ILK4"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/block/ftl" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ILK4"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 The FTL Team. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>