{{- $dbs := .Databases -}}
{{- with .QueriesCtx -}}
{{- $module := .Module -}}

// Code generated by FTL. DO NOT EDIT.
package db

{{ if .Imports -}}
import (
{{- range .Imports }}
    {{.}}
{{- end }}
)
{{ end }}

{{- range $dbs -}}
//ftl:database {{.Type}} {{.Name}}
type {{.Name|title}}Config struct {}

type {{.Name|title}}Handle = ftl.DatabaseHandle[{{.Name|title}}Config]
{{ end -}}

{{- range .Data }}
type {{.Name|title}}
	{{- if .TypeParameters}}[
		{{- range $i, $tp := .TypeParameters}}
			{{- if $i}}, {{end}}{{$tp}} any
		{{- end -}}
	]{{- end}} struct {
  {{- range .Fields}}
  	{{.Name|title}} {{type $module .Type}}
  {{- end}}
}
{{- end -}}

{{- range .Verbs }}
	{{ if and (eq (type $module .Request) "ftl.Unit") (eq (type $module .Response) "ftl.Unit")}}
type {{.Name|title}}Client func(context.Context) error
	{{- else if eq (type $module .Request) "ftl.Unit"}}
type {{.Name|title}}Client func(context.Context) ({{type $module .Response}}, error)
	{{- else if eq (type $module .Response) "ftl.Unit"}}
type {{.Name|title}}Client func(context.Context, {{type $module .Request}}) error
	{{- else}}
type {{.Name|title}}Client func(context.Context, {{type $module .Request}}) ({{type $module .Response}}, error)
	{{- end}}
{{- end}}

func init() {
	reflection.Register(
{{- range $dbs}}
		{{- if eq .Type "postgres" }}
		reflection.Database[{{.Name|title}}Config]("{{.Name}}", server.InitPostgres),
		{{- else if eq .Type "mysql" }}
		reflection.Database[{{.Name|title}}Config]("{{.Name}}", server.InitMySQL),
		{{- end }}
{{- end}}
	)
}
{{- end -}}
